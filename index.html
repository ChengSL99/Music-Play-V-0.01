<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Music Player - No Alerts</title>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;600&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #f8c8c4;
            --dark: #4a3f3d; 
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.4);
            --vol-track: rgba(74, 63, 61, 0.1);
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: linear-gradient(135deg, #e0e0e0, #f8c8c4);
            display: flex; justify-content: center; align-items: center;
            height: 100vh; margin: 0; font-family: 'Poppins', 'Kantumruy Pro', sans-serif;
        }

        .phone-container {
            width: 360px; height: 750px;
            background: var(--primary); border-radius: 50px;
            padding: 25px; display: flex; flex-direction: column;
            position: relative; border: 8px solid #fff;
            box-shadow: 25px 25px 50px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        #yt-player-hidden { display: none; }

        /* --- Click Feedback Animation --- */
        .play-pause:active, 
        .main-btns i:active, 
        .timer-btn:active, 
        .fa-plus-circle:active,
        .fa-trash-can:active {
            transform: scale(0.85);
            transition: 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .song-item { transition: all 0.2s ease; }
        .song-item:active { transform: scale(0.97); background: var(--white); }

        /* Modal Area */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); display: none; justify-content: center; 
            align-items: center; z-index: 1000; border-radius: 42px; backdrop-filter: blur(8px);
        }
        .modal-content { 
            background: var(--primary); width: 85%; padding: 30px; border-radius: 35px; 
            text-align: center; border: 2px solid var(--white);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Visualizer */
        .audio-visual {
            width: 100%; height: 180px; background: linear-gradient(145deg, #e2b4b0, #ffd6d2);
            border-radius: 35px; margin-bottom: 15px; display: flex; justify-content: center; align-items: center;
            box-shadow: inset 8px 8px 16px #d1a9a5, inset -8px -8px 16px #ffe7e3;
        }
        .disc-wrapper {
            width: 110px; height: 110px; background: #222; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; border: 4px solid #fff; 
            box-shadow: 0 15px 25px rgba(0,0,0,0.2);
        }
        .spinning { animation: spin 6s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .track-info h3 { text-align: center; font-size: 14px; color: var(--dark); margin: 10px 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* Controls */
        .controls-section { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 20px; }
        .main-btns { display: flex; align-items: center; gap: 30px; }
        .play-pause {
            width: 60px; height: 60px; background: var(--dark); color: white;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            cursor: pointer; font-size: 20px; box-shadow: 0 8px 20px rgba(74, 63, 61, 0.3);
        }

        /* Volume */
        .volume-wrapper { display: flex; align-items: center; gap: 10px; width: 190px; }
        .volume-slider { -webkit-appearance: none; width: 100%; height: 4px; background: var(--vol-track); border-radius: 10px; cursor: pointer; }
        .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: var(--dark); border: 2px solid var(--white); }

        /* Timer UI */
        .timer-container { display: flex; gap: 8px; margin-top: 5px; }
        .timer-btn {
            background: var(--glass); border: 1.2px solid var(--dark); border-radius: 10px;
            padding: 4px 12px; font-size: 10px; color: var(--dark); cursor: pointer; transition: 0.3s;
            font-weight: 600;
        }
        .timer-btn.active { 
            background: var(--dark); 
            color: var(--white); 
            border-color: var(--white);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        /* Playlist */
        .playlist-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding: 0 5px; }
        .playlist-box { flex: 1; background: var(--glass); border-radius: 25px; padding: 12px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.4); }
        .song-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.4); padding: 10px 12px; border-radius: 15px; margin-bottom: 8px; cursor: pointer; }
        .song-item.active { background: var(--white); border: 1.5px solid var(--dark); }
        .song-name { font-size: 11px; width: 80%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--dark); font-weight: 500; }
    </style>
</head>
<body>

    <div class="phone-container">
        <div id="yt-player-hidden"></div>

        <div class="modal-overlay" id="searchModal">
            <div class="modal-content">
                <h4 style="color: var(--dark); margin-top: 0; letter-spacing: 1px;">ADD NEW MUSIC</h4>
                <input type="text" id="ytUrlInput" style="width:100%; padding:12px; border-radius:12px; border:none; margin-bottom:20px; background:rgba(255,255,255,0.6);" placeholder="Paste YouTube link...">
                <button style="background:var(--dark); color:white; padding:12px; border:none; border-radius:12px; width:100%; font-weight:700; cursor:pointer;" onclick="processAdd()">ADD TO LIST</button>
                <button onclick="closeSearch()" style="background:none; border:none; margin-top:15px; color:var(--dark); cursor:pointer; font-size:12px; opacity: 0.6;">Close</button>
            </div>
        </div>

        <div class="audio-visual">
            <div class="disc-wrapper" id="disc-ui"><i class="fas fa-compact-disc" style="font-size:55px; color:#f8c8c4"></i></div>
        </div>

        <div class="track-info"><h3 id="current-song-title">Select a Song</h3></div>

        <div class="controls-section">
            <div class="main-btns">
                <i class="fas fa-backward-step" style="color:var(--dark); cursor:pointer; font-size: 18px;" onclick="prevSong()"></i>
                <div class="play-pause" onclick="togglePlay()"><i class="fas fa-play" id="play-icon"></i></div>
                <i class="fas fa-forward-step" style="color:var(--dark); cursor:pointer; font-size: 18px;" onclick="nextSong()"></i>
            </div>
            
            <div class="volume-wrapper">
                <i class="fas fa-volume-off vol-icon" id="vol-mute-icon" onclick="toggleMute()"></i>
                <input type="range" class="volume-slider" id="volume" min="0" max="100" value="80">
                <i class="fas fa-volume-high vol-icon"></i>
            </div>

            <div class="timer-container">
                <span style="font-size: 10px; color: var(--dark); align-self: center; margin-right: 5px; font-weight: 600;">SLEEP:</span>
                <button class="timer-btn" id="timer-15" onclick="setSleepTimer(15)">15m</button>
                <button class="timer-btn" id="timer-30" onclick="setSleepTimer(30)">30m</button>
                <button class="timer-btn active" id="timer-0" onclick="setSleepTimer(0)">Off</button>
            </div>
        </div>

        <div class="playlist-header">
            <span style="font-weight:700; font-size:11px; color:var(--dark); letter-spacing: 1px;">MY PLAYLIST</span>
            <i class="fas fa-plus-circle" style="font-size:24px; cursor:pointer; color:var(--dark)" onclick="openSearch()"></i>
        </div>

        <div class="playlist-box" id="playlist"></div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let songs = JSON.parse(localStorage.getItem('myPlaylist')) || []; 
        let player, currentIndex = -1, isPlaying = false, isMuted = false, lastVolume = 80;
        let sleepTimeout = null;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('yt-player-hidden', {
                height: '0', width: '0',
                playerVars: { 'autoplay': 0, 'controls': 0, 'disablekb': 1 },
                events: { 
                    'onStateChange': onPlayerStateChange, 
                    'onReady': () => { if(songs.length > 0) renderPlaylist(); } 
                }
            });
        }

        function onPlayerStateChange(event) {
            const playIcon = document.getElementById('play-icon');
            const disc = document.getElementById('disc-ui');
            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true; playIcon.className = "fas fa-pause"; disc.classList.add('spinning'); updateTitle();
            } else if (event.data == YT.PlayerState.ENDED) { nextSong(); }
            else { isPlaying = false; playIcon.className = "fas fa-play"; disc.classList.remove('spinning'); }
        }

        /* --- កែសម្រួល៖ ដក Alert ចេញ --- */
        function setSleepTimer(minutes) {
            if (sleepTimeout) clearTimeout(sleepTimeout);
            
            document.querySelectorAll('.timer-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`timer-${minutes}`).classList.add('active');

            if (minutes > 0) {
                // Alert ត្រូវបានលុបចេញពីទីនេះ
                sleepTimeout = setTimeout(() => {
                    player.pauseVideo();
                    document.querySelectorAll('.timer-btn').forEach(btn => btn.classList.remove('active'));
                    document.getElementById('timer-0').classList.add('active');
                }, minutes * 60000);
            }
        }

        function togglePlay() { 
            if (currentIndex !== -1) {
                isPlaying ? player.pauseVideo() : player.playVideo(); 
            } else if (songs.length > 0) {
                playAt(0);
            }
        }

        function playAt(index) { 
            currentIndex = index; 
            player.loadVideoById(songs[currentIndex].id); 
            renderPlaylist(); 
        }

        function nextSong() { if (songs.length > 0) playAt((currentIndex + 1) % songs.length); }
        function prevSong() { if (songs.length > 0) playAt((currentIndex - 1 + songs.length) % songs.length); }

        function processAdd() {
            const url = document.getElementById('ytUrlInput').value;
            const reg = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(reg);
            const id = (match && match[2].length == 11) ? match[2] : null;
            if (id) {
                songs.push({ title: "Loading...", id: id });
                localStorage.setItem('myPlaylist', JSON.stringify(songs));
                renderPlaylist();
                if (songs.length === 1 || !isPlaying) playAt(songs.length - 1);
                closeSearch();
                document.getElementById('ytUrlInput').value = "";
            }
        }

        function updateTitle() {
            const ytTitle = player.getVideoData().title;
            if (ytTitle && currentIndex !== -1 && (songs[currentIndex].title === "Loading..." || songs[currentIndex].title === "Select a Song")) {
                songs[currentIndex].title = ytTitle;
                localStorage.setItem('myPlaylist', JSON.stringify(songs));
                renderPlaylist();
            }
        }

        function renderPlaylist() {
            const container = document.getElementById('playlist');
            container.innerHTML = "";
            songs.forEach((song, index) => {
                const div = document.createElement('div');
                div.className = `song-item ${index === currentIndex ? 'active' : ''}`;
                div.innerHTML = `<div class="song-name" onclick="playAt(${index})">${song.title}</div>
                    <i class="fas fa-trash-can" style="color:#ff5e5e; font-size:12px" onclick="removeSong(event, ${index})"></i>`;
                container.appendChild(div);
            });
            if (currentIndex !== -1) document.getElementById('current-song-title').innerText = songs[currentIndex].title;
        }

        function removeSong(event, index) {
            event.stopPropagation();
            songs.splice(index, 1);
            localStorage.setItem('myPlaylist', JSON.stringify(songs));
            if (songs.length === 0) {
                player.stopVideo(); currentIndex = -1;
                document.getElementById('current-song-title').innerText = "Select a Song";
            } else if (index === currentIndex) {
                nextSong();
            }
            renderPlaylist();
        }

        function toggleMute() {
            const volIcon = document.getElementById('vol-mute-icon');
            const volSlider = document.getElementById('volume');
            if (!isMuted) {
                lastVolume = volSlider.value; player.setVolume(0); volSlider.value = 0;
                volIcon.className = "fas fa-volume-xmark vol-icon"; isMuted = true;
            } else {
                player.setVolume(lastVolume); volSlider.value = lastVolume;
                volIcon.className = "fas fa-volume-off vol-icon"; isMuted = false;
            }
        }

        function openSearch() { document.getElementById('searchModal').style.display = 'flex'; }
        function closeSearch() { document.getElementById('searchModal').style.display = 'none'; }
        
        document.getElementById('volume').oninput = function() { 
            player.setVolume(this.value);
            if (this.value > 0) {
                isMuted = false;
                document.getElementById('vol-mute-icon').className = "fas fa-volume-off vol-icon";
            }
        };
    </script>
</body>
</html>